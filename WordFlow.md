# 🎯 Qulome 项目完整交互逻辑描述

微信文章排版工具的完整交互逻辑：

## 📱 整体架构与界面体系

### 🏗️ 核心架构
Qulome 采用**单页应用架构**，包含6个主要界面（视图），通过URL Hash进行切换：
1. **欢迎界面** - 应用启动入口，提供两种工作路径选择
2. **主视图** - Quill富文本编辑器
3. **图标库** - 图标管理与插入功能
4. **主题库** - 主题创建、浏览与管理
5. **草稿仓** - 文档存储与批量处理
6. **发布仓** - 成品预览与导出

**特殊视图：**
- **主题编辑器**：这是一个特殊的**模态框（浮层）视图**，它不参与主视图的切换流程，而是从"主题库"视图中触发并覆盖在当前界面之上。

### 🎨 视觉设计统一性
- **主色调**: `#0E2A73` (深蓝色)，用于关键操作、激活状态和Logo。
- **辅助色**: 包含主色调的10%透明度版本 (`rgba(14, 42, 115, 0.1)`) 用于悬停效果，以及 `#E53E3E` (红色) 用于危险操作。
- **背景色**: 整体页面背景为 `#F9F9F9` (暖灰白)，侧边栏背景为 `#2D3748` (深石板灰)。
- **文本颜色**: 主要文字为 `#2D3748` (深石板灰)，次要文字和提示为 `#718096` (中灰色)。
- **边框与分割线**: 统一使用 `#E2E8F0` (浅灰色)。
- **圆角**: 采用大圆角设计，通用圆角尺寸为 `12px` (`--border-radius-lg`)。
- **阴影**: 使用柔和的阴影 (`--shadow-md`) 来营造元素的层次感。

## 🚀 用户启动与导航流程

### 🎪 欢迎界面交互逻辑
**启动场景**：
```
用户打开应用 → 显示欢迎界面
├── 中央显示 "κύλημα" 希腊艺术字
├── 副标题 "文字可以很美"
└── 两个并列按钮：
    ├── [选择模版] → 直接跳转主题库界面
    └── [直接开始] → 直接跳转编辑器界面（使用默认主题）
```

**按钮交互反馈 (特指欢迎页按钮)**：
- **默认状态**: 透明背景 + `1px` 主题色实线边框 + 主题色文字。
- **悬停状态**: 浅主题色背景 (`rgba(14, 42, 115, 0.1)`) + 边框和文字颜色不变。
- **点击状态**: 按钮有 `1px` 的向下位移，产生轻微的按压感。

### 🧭 侧边栏导航系统
**导航结构**：
```
┌──────────────┐
│   Qulome     │ ← Logo（可点击返回欢迎界面）
├──────────────┤
│    主视图     │ ← 富文本编辑器
│    图标库     │ ← 图标管理
│    主题库     │ ← 主题管理
│    草稿仓     │ ← 文档存储
│    发布仓     │ ← 成品管理
└──────────────┘
```

**导航逻辑**：
- 侧边栏始终显示
- 点击Logo返回欢迎界面
- 点击功能按钮通过URL Hash切换到对应界面
- 界面切换刷新，单页应用路由

## ✍️ 编辑器核心交互逻辑

### 📝 富文本编辑系统
**技术选择**：使用Quill.js富文本编辑器

**编辑器功能**：
- 完整的富文本工具栏（粗体、斜体、下划线、链接等）
- 支持从Markdown文件导入内容
- 支持图标插入（通过工具栏按钮）
- 主题样式实时应用

### 🎯 图标插入交互流程
**完整流程**：
```
编辑器界面 → 点击工具栏图标按钮 → 弹出图标库浮层
├── 浮层显示已保存的图标网格
├── 点击选择图标 → 将占位符 `[icon:图标名称]` 插入光标位置
└── 浮层自动关闭 → 继续编辑
```

**技术实现**：
- 编辑时显示简化标记 `[icon:图标名称]`
- 在最终导出为微信格式HTML时，占位符才会被替换为实际的SVG代码。

### 💾 自动保存与状态管理
**保存策略**：
- **触发条件**: 用户在编辑器中停止输入2-3秒后自动保存当前内容到草稿。
- **状态提醒**: 任何文本更改都标记为"未保存"状态（此功能待实现）。
- **切换保护**: 切换页面时，若有未保存内容，弹出确认对话框（此功能待实现）。

**状态管理逻辑**：
```
内容变更 → (标记未保存状态) → 停止输入2-3秒 → 自动保存到当前草稿 → (清除未保存状态)
```

## 🎨 主题系统交互逻辑

### 🏛️ 主题库界面布局
**三栏布局结构**：
```
┌─────────────────────────────────────────────────────────┐
│ 左侧导航栏     │     中间主题展示区域      │  右侧创建区域  │
│ ├─ 主视图      │  ┌─────────────────────┐ │ 从这里开始    │
│ ├─ 图标库      │  │    我的主题库        │ │              │
│ ├─ 主题库 ✓    │  │    2×N网格展示      │ │ 为您的新主题  │
│ ├─ 草稿仓      │  │ ┌─────┐  ┌─────┐   │ │ 命名...      │
│ └─ 发布仓      │  │ │主题1 │  │主题2 │   │ │ [___________]│
│               │  │ │      │  │     │   │ │              │
│               │  │ └─────┘  └─────┘   │ │ [创建新主题]   │
│               │  │  ... 等等 ...       │ │              │
└─────────────────────────────────────────────────────────┘
```

**新主题创建流程**：
1. 用户在右侧创建区域的输入框中为新主题命名。
2. 点击 **[创建新主题]** 按钮。
3. 系统使用默认模板创建一个新主题，该主题的卡片会立即出现在中间的展示区域。
4. **流程结束。** 用户如果想编辑这个新主题，需要手动点击新卡片上的"编辑"按钮。

### 🎪 主题卡片交互逻辑
**主题卡片结构**：
- 主题名称（可点击重命名）
- 实时样式预览内容（标题、正文、链接、引用等）
- 双按钮：[应用] 和 [编辑]
- 删除按钮（非系统主题）

**交互行为**：
```
主题卡片交互：
├── 点击[应用]按钮 → 将该主题设为当前激活主题，并实时更新编辑器及预览样式。
├── 点击[编辑]按钮 → 触发"主题编辑器"模态框，在当前页面上弹出。
├── 点击主题名称 → 名称变为输入框，可直接重命名。
├── 点击[×]删除按钮 → 弹出确认框，确认后删除该主题。
```

### 🔧 主题编辑器详细交互
**触发方式**：在"主题库"视图中，点击任意主题卡片上的 **[编辑]** 按钮。编辑器会以**模态框（浮层）**的形式覆盖在当前页面上。

**编辑器布局**：
```
┌─────────────────────────────────────────────────────────┐
│        [浮层] 主题编辑器: [主题名称]              [×]      │
├─────────────────────────────────────────────────────────┤
│ 左侧Tab式编辑区域         │    右侧固定预览区域        │
│ ┌─────────────────────┐  │  ┌─────────────────────┐   │
│ │[基础][标题][正文]...│  │  │     实时预览内容     │   │
│ │                     │  │  │  (H1, p, a, block..)│   │
│ │  当前Tab下的所有设置项 │  │  │   (350px固定宽度)   │   │
│ │  (滑块、颜色选择器等)  │  │  │                    │   │
│ └─────────────────────┘  │  └─────────────────────┘   │
├─────────────────────────────────────────────────────────┤
│ [恢复默认]                      [取消] [保存主题]        │
└─────────────────────────────────────────────────────────┘
```

**实时预览逻辑**：
- **触发机制**: 左侧编辑区的任何参数（如颜色选择、滑块拖动）发生改变，都会**立即**更新右侧预览区对应元素的样式。
- **预览内容**: 预览区包含一个标准的文章片段，涵盖H1/H2/H3、段落、链接、引用、代码块、列表、分割线等，用于完整展示主题效果。
- **保存机制**: 所有更改仅在预览区生效。只有当用户点击右下角的 **[保存主题]** 按钮时，所有样式更改才会被保存到该主题对象中，然后浮层关闭。点击[取消]或[×]则放弃所有更改。

**Tab式编辑交互**：
- 左侧编辑区域通过Tab按钮（基础设置、标题系统、正文系统等）来组织大量的样式参数。
- 点击不同的Tab会切换下方显示的表单内容，方便用户聚焦于特定部分的样式调整。

## 🗂️ 文档管理交互逻辑

### 📄 Markdown文档处理流程
**单文档导入逻辑**：
此功能在**主视图（编辑器）**中提供。
```
编辑器界面 → 点击[导入Markdown]按钮
├── 弹出系统文件选择器
├── 用户选择一个本地的.md文件
├── 系统读取文件内容，使用Showdown库将其转换为HTML
├── 转换后的HTML会**完全替换**当前编辑器中的所有内容
└── 用户可以继续在编辑器中对导入的内容进行编辑和排版
```

**单文档编辑流程**：
```
草稿仓界面 → 点击单个草稿 → 进入编辑器
├── 草稿内容加载到Quill编辑器
├── 支持富文本编辑和主题应用
└── 编辑完成后通过"自动保存"更新草稿，或手动保存
```

### 📦 草稿仓批量操作
**界面布局**：
```
草稿列表展示：
☑ 草稿1 - 标题A （复选框选择）
☐ 草稿2 - 标题B
☑ 草稿3 - 标题C
[应用主题] [删除] [移动到发布仓] （批量操作按钮）
```
**注意：** 此批量操作功能在文档中定义，但尚未在代码中实现。

**批量操作逻辑**：
- 复选框多选机制
- 批量应用主题：选择主题后应用到所有选中草稿
- 批量删除：确认后删除所有选中草稿
- 批量发布：移动选中草稿到发布仓

## 🎨 图标库管理系统

### 🖼️ 图标库界面布局
**左右分栏设计**：
```
┌─────────────────────────────────────────────────────────┐
│ 左侧导航栏     │           右侧主内容区域                │
│ ├─ 图标库 ✓    │  ┌─────────────────────────────────────┐ │
│               │  │    我的图标库                       │ │
│               │  ├─────────────────────────────────────┤ │
│               │  │  已存图标展示区域 │ 添加新图标区域   │ │
│               │  │ (自适应网格布局) │ (固定350px宽度)  │ │
│               │  │                 │                │ │
│               │  │ 🗂️ 📊 🏐 ⚡ 🎯   │ 输入名称:       │ │
│               │  │ 🔋 👆 💪 ➡️ 📥   │ [___________] │ │
│               │  │ 🔲 📱 ⭐ 🎨 📝   │ SVG代码:       │ │
│               │  │                 │ [___________] │ │
│               │  │                 │ [保存到图标库]   │ │
└─────────────────────────────────────────────────────────┘
```
**注意：** 图标分类与筛选功能在文档中定义，但尚未在代码中实现。

### ➕ 图标添加流程
**添加交互**：
```
右侧添加区域操作：
├── 输入图标名称
├── 粘贴SVG代码
├── 点击[保存到图标库]按钮
└── 图标出现在左侧图标网格中，实时更新
```

## 🚀 发布与导出系统

### 📤 发布仓功能
**发布仓作用**：
- 存储已完成的文章成品
- 提供最终预览功能
- 支持批量导出操作
- 格式转换为微信编辑器兼容的HTML

**导出逻辑**：
```
发布仓文章 → 点击导出 → 格式转换：
├── 简化图标标记 [icon:名称] → 转换为实际SVG代码
├── 富文本格式 → 转换为微信编辑器兼容HTML
├── 主题样式 → 内联CSS样式
└── 生成最终HTML文件供复制粘贴
```
**注意：** 发布仓及导出功能在文档中定义，但尚未在代码中实现。

## 🔄 跨界面联动逻辑

### 🔗 界面间数据流转
**主要数据流**：
```
欢迎界面 → 选择路径 → 目标界面
主题库 → 应用主题 → 编辑器（主题实时生效）
主题库 → 编辑主题 → 弹出主题编辑器浮层
编辑器 → 自动保存 → 草稿仓（更新当前草稿）
草稿仓 → 选择草稿 → 编辑器（加载草稿内容）
图标库 → 添加图标 → 数据存入localStorage
编辑器 → 插入图标 → 从图标库读取数据，弹出选择浮层
```

### 💾 数据持久化策略
**存储机制**：
- 使用浏览器`localStorage`存储所有数据。
- **主题**: `themes` - 存储所有主题对象的数组。`activeThemeId` - 当前激活主题的ID。
- **图标**: `icons` - 存储所有图标对象的数组。
- **草稿**: `drafts` - 存储所有草稿对象的数组。`currentDraftId` - 当前正在编辑的草稿ID。
- **发布**: `published` - 存储所有已发布文章的数组。
- 自动保存策略确保草稿数据不轻易丢失。

## 🎯 用户体验优化点

### ⚡ 即时反馈机制
1. **实时预览**：主题编辑器参数调整立即反映在预览区。
2. **状态提示**：未保存内容实时提醒（待实现）。
3. **操作反馈**：按钮悬停、点击状态清晰反馈。
4. **智能保存**：用户在编辑器停止输入后智能保存。

### 🛡️ 数据保护策略
1. **切换确认**：有未保存内容时切换页面弹出确认（待实现）。
2. **批量操作确认**：删除等危险操作需要二次确认（部分实现，如删除主题）。
3. **自动保存**：防止意外丢失编辑内容。
4. **本地存储**：数据存储在用户本地，隐私安全。

这个完整的交互逻辑设计确保了Qulome工具的用户体验流畅、功能完整、逻辑清晰。每个界面都有明确的职责分工，用户可以高效地完成从内容创作到最终发布的完整工作流程。